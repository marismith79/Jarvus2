{% extends "base.html" %}

{% block title %}Chatbot - Jarvus{% endblock %}

{% block content %}
<style>
    .message p {
        white-space: pre-wrap;
        line-height: 1.5;
        margin: 0;
    }
</style>
<div class="chatbot-layout">
    <!-- Dashboard Sidebar -->
    <aside class="chatbot-dashboard">
        <div class="dashboard-header">
            <button class="cta-button new-agent-btn">New Agent +</button>
        </div>
        <div class="dashboard-content">
            <div class="chat-list">
                {% for agent in agents %}
                <div class="chat-item" data-agent-id="{{ agent.id }}">
                    {{ agent.name }}
                </div>
                {% endfor %}
            </div>
        </div>
    </aside>

    <!-- Chat Main Area -->
    <section class="chatbot-card">
        <!-- Greeting -->
        <div class="greeting-section">
            <h1 class="greeting-title" id="agent-greeting">Select an agent to start chatting</h1>
            <p class="greeting-subtitle" id="agent-subtitle">Choose an agent from the sidebar or create a new one</p>
        </div>

        <!-- Chat history -->
        <div id="chat-history" class="chat-history"></div>

        <!-- Chat input bar -->
        <form class="chat-input-bar" onsubmit="event.preventDefault(); sendCommand();">
            <input type="text" id="chat-input" class="chat-input" placeholder="Ask or search for anything..." autocomplete="off">
            <button type="submit" class="icon-btn send-btn" id="send-btn">➔</button>
        </form>
    </section>

    <!-- Agent Creation View -->
    <section id="agent-creation-view" style="display: none;">
        <div class="creation-step active" id="step-1">
            <h2>Choose my name...</h2>
            <input type="text" id="agent-name" placeholder="Morning Brew Agent...">
            <button class="next-step-btn">↓</button>
        </div>

        <div class="creation-step" id="step-2">
            <h2>Choose my tools...</h2>
            <div id="agent-creation-tool-list" class="tool-list-container">
                <!-- Tools are dynamically populated by chatbot.js -->
            </div>
            <button class="next-step-btn">↓</button>
        </div>

        <div class="creation-step" id="step-3">
            <h2>Describe what I do (optional)</h2>
            <textarea id="agent-description" placeholder="You are an agent that manages my inbox and tells me if people reply to my outreach messages."></textarea>
            <button id="finish-creation-btn">Create Agent</button>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Pass connection status to JavaScript
    window.gmailConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.docsConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.slidesConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.meetConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.driveConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.sheetsConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.calendarConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.notionConnected = {{ 'true' if notion_connected else 'false' }};
    window.slackConnected = {{ 'true' if slack_connected else 'false' }};
    window.zoomConnected = {{ 'true' if zoom_connected else 'false' }};
</script>
<script src="{{ url_for('static', filename='js/chatbot.js') }}?v=3"></script>
{% endblock %}

