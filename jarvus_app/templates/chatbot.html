{% extends "base.html" %}

{% block title %}Chatbot - Jarvus{% endblock %}

{% block content %}
<style>
    .message p {
        white-space: pre-wrap;
        line-height: 1.5;
        margin: 0;
    }
</style>
<div class="chatbot-layout">
    <!-- Chat Main Area -->
    <section class="chatbot-card">
        <!-- Greeting -->
        <div class="greeting-section">
            <h1 class="greeting-title">Hello, {{ current_user.name or 'User' }}</h1>
            <p class="greeting-subtitle">How can I help you today?</p>
        </div>

        <!-- Suggestions header -->
        <div class="suggestions-header" id="suggestions-header">
            <span class="suggestions-label">Suggestions</span>
            <button class="dropdown-btn">▾</button>
        </div>

        <!-- Suggestion cards -->
        <div class="suggestions-cards-wrapper" id="suggestions-wrapper">
            <div class="suggestions-cards">
                <div class="card card-gmail" onclick="insertSuggestion('Summarize my 5 most recent emails')">
                    <div class="card-text gmail-text">
                        Summarize my most recent work emails 
                    </div>
                </div>
                <div class="card card-calendar" onclick="insertSuggestion('Show my upcoming events')">
                    <div class="card-text calendar-text">
                        Show all my upcoming calls
                    </div>
                </div>
                <div class="card card-salesforce" onclick="insertSuggestion('Update the opportunity to Signed')">
                    <div class="card-text salesforce-text">
                        Create a notion database for my sales
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat history -->
        <div id="chat-history" class="chat-history"></div>

        <!-- Chat input bar -->
        <form class="chat-input-bar" onsubmit="event.preventDefault(); sendCommand();">
            <div class="input-buttons">
                <div class="tool-selector">
                    <button type="button" class="icon-btn input-at" id="atButton">@</button>
                    <div class="tool-dropdown" id="toolDropdown">
                        <!-- Tool items will be populated dynamically -->
                    </div>
                </div>
            </div>
            <input type="text" id="chat-input" class="chat-input" placeholder="Ask or search for anything..." autocomplete="off">
            <button type="submit" class="icon-btn send-btn" id="send-btn">➔</button>
        </form>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Pass connection status to JavaScript
    window.gmailConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.calendarConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.slidesConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.meetConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.driveConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.sheetsConnected = {{ 'true' if google_workspace_connected else 'false' }};
    window.notionConnected = {{ 'true' if notion_connected else 'false' }};
    window.slackConnected = {{ 'true' if slack_connected else 'false' }};
    window.zoomConnected = {{ 'true' if zoom_connected else 'false' }};
    window.vercelConnected = {{ 'true' if vercel_connected else 'false' }};
</script>
<script src="{{ url_for('static', filename='js/chatbot.js') }}?v=3"></script>
{% endblock %}

